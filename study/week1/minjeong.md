# Week1

## 개발환경 구성하기

### orbstack이란?

- orbstack이 정확히 무슨 프로그램인지?
  - orbstack은 macOS 전용 프로그램 → 현재의 windows, ubuntu 환경에서 실행 불가능
  - 컨테이너, 경량 리눅스 VM을 실행할 수 있는 프로그램
- 왜 orbstack을 사용하는지?
  - ebpf는 리눅스 커널 기술이기 때문에 macOS, windows 커널에서 사용이 불가능
  - orbstack은 경량 리눅스 VM을 제공하기 때문에 macOS에서 가볍게 리눅스 커널 환경을 구축해 ebpf를 사용하기 좋음

### Windows 개발환경 구축

- windows는 orbstack 설치 자체가 불가능하기 때문에 다른 대안을 선택
- vmware에서 ubuntu VM을 생성 후 사용
  - orbstack과 비교했을 때, 지나치게 무겁고 느림
- WSL2 ubuntu를 사용
  - orbstack이 자유롭게 경량 리눅스 VM을 생성하고 없앴던 것과 달리 유연성 없어짐
  - 유연성을 되살리기 위해 docker를 함께 사용 → docker container는 호스트와 커널을 공유
- 실제 ubuntuOS가 깔린 pc를 사용
  - 마찬가지로 유연성을 살리기 위해 docker를 함께 사용
  - 네이티브 리눅스 커널 환경이기 때문에 WSL2에서 발생할 수 있는 각종 제약이 사라짐

### 현재 개발 환경

- OS: windows 11, WSL2 ubuntu 24.04
- Kernal: 6.6.87.2-microsoft-standard-WSL2
- 진행
  - WSL2 내 도커 컨테이너를 띄워 진행
  - 이후 ubuntu desktop OS가 설치된 다른 노트북에서 개발 환경을 구성한 후 진행할 예정

## eBPF가 무엇인가요?

<https://ebpf.io/ko-kr/what-is-ebpf/>

### 등장 배경

- 커널의 동작
  - 애플리케이션과 하드웨어 사이의 중간 계층
  - 하드웨어 자원 관리, 제어 수행
  - 애플리케이션은 시스템 콜을 통해 커널 모드 전환 및 하드웨어 접근
- 전통적으로 커널의 기능을 확장하는 방식은 2가지 존재
  - 네이티브 지원: 커널 커뮤니티에 기능 요청 및 커널 소스코드 변경을 통한 새로운 커널 업데이트 대기
  - 커널 모듈 작성: 커널 버전에 따른 호환성 보장 필수
    - 직접 커널 모듈을 작성한 후 추가하는 것은 특히 보안상 경계선이 존재하지 않아 위험할 수 있음
    - 커널 모듈은 직접적으로 하드웨어, 메모리, 실행 흐름에 접근이 가능해 사소한 버그나 잘못된 동작에 시스템 전체가 붕괴될 수 있음
- 따라서 전통적인 방식과 다르게 안전하고, 즉각적으로 커널을 확장 가능한 방식이 필요
  - 해당 방식이 바로 eBPF
  - eBPF 사용 시 커널 소스 코드를 변경하거나 커널 모듈을 로드하지 않고도 커널 기능의 확장이 가능

### 커널 확장

- 커널 기능의 확장이 필요한 이유?
  - 성능, 관측가능성, 보안, 네트워크, 하드웨어 등의 다양한 이유가 존재할 수 있음
- 커널 확장 사례
  - 애플리케이션, 워크플로 성능 최적화: 스케줄러, 메모리, 네트워크 스택 등 최적화
  - 관측가능성: 네트워크 패킷, 파일 접근, 프로세스 실행 등
  - 보안 강화: 표준 커널로는 부족한 보안 정책 추가
  - 네트워크 고도화

### eBPF 원리

- eBPF 추상화 툴을 통해 프로그램 작성
  - bcc, bpftrace 등의 고수준 추상화 툴을 사용해서 작성 가능
- 훅, probe를 통해 해당 프로그램 실행
  - 훅의 경우 이벤트 기반 실행
  - kprobe, uprobe를 통해 애플리케이션 임의의 위치에 프로그램을 동적으로 부착 가능
- 해당 프로그램이 안전하게 실행 가능한지 검증 진행
  - eBPF 실행 권한, 무한 루프 여부, 시스템 악영향 등을 검사
  - 커널 모듈을 직접 작성하고 추가하는 것과 달리 안전성 보장
- 검증 완료 시 JTL 컴파일 진행
- 프로그램이 실행되는 동안 eBPF 맵이라는 다양한 자료구조를 사용해 데이터를 저장
- 만약 커널 함수가 필요한 경우 대신 커널이 제공하는 헬퍼 함수를 호출
  - 직접적으로 커널 함수를 호출한다면 호환성 문제 발생

## 진행하고 싶은 프로젝트?

- 간이 pcap sniffer
- 개인적으로 방화벽에 관심이 많아 패킷 필터링, 캡처에 대한 프로젝트를 진행하고 싶음
